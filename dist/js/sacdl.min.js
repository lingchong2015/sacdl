var Utils=function(){function n(){var n={},a={name:"languages",children:[]};if(e&&e.items){var r=e.items;r.forEach(function(e,a){"undefined"==typeof n[e.language]&&(n[e.language]=a)});for(var t in n){"null"===t&&(t="others");var u={name:t,children:[]};r.forEach(function(n,e){var a={name:n.full_name,watchers_count:n.watchers_count,forks_count:n.forks_count};(n.language===t||"null"===n.language&&"others"===t)&&u.children.push(a)}),a.children.push(u)}}return a}var e,a;return{getData:function(r){e=r,a=n()},getBarData:function(){var n=a.children,e={labels:[],series:[]},r=[];return n.forEach(function(n){e.labels.push(n.name),r.push(n.children.length)}),e.series.push({label:"Projects count",values:r}),e},getStackData:function(){var n=a.children,e={name:"repos",languages:[]};return n.forEach(function(n){if("null"!==n.name){var a={language:n.name,count:n.children.length};e.languages.push(a)}}),[e]},getTreeData:function(){return a}}}();
var Searcher=function(){function t(){o.q=r.property("value")||"bitcoin";var t=[];for(var n in o)t.push(n+"="+o[n]);return s=e+"?"+t.join("&"),console.log(s),i.text("当前搜索地址: "+s),s}var e,r,n,i,s="",c=[],o={q:"bitcoin",sort:"forks",order:"desc",per_page:100};return{settings:{baseApiUrl:"https://api.github.com/search/repositories"},init:function(){r=d3.select("#search-input"),n=d3.select("#search-btn"),i=d3.select("#search-msg"),e=this.settings.baseApiUrl,n.on("click",function(){t(),c.forEach(function(t){try{t(s)}catch(e){console.log(e)}})})},addListener:function(t){c.push(t)}}}();
var Bar=function(){function t(t){for(var e=0;e<t.labels.length;e++)for(var r=0;r<t.series.length;r++)u.push(t.series[r].values[e])}function e(){u=[],a=Utils.getBarData(),i=l*a.series.length,t(a);var e=d3.scale.category20(),r=l*u.length+c*a.labels.length,g=d3.scale.linear().domain([0,d3.max(u)]).range([0,s]),h=d3.scale.linear().range([r+c,0]);n=d3.svg.axis().scale(h).tickFormat("").tickSize(0).orient("left");var f=chart.attr("width",o+s+d).attr("height",r),p=f.selectAll("g").data(u,function(t,e){return[t,e]}),x=p.enter().append("g").attr("transform",function(t,e){return"translate("+o+","+(e*l+c*(.5+Math.floor(e/a.series.length)))+")"});x.append("rect").attr("fill",function(t,r){return e(r%a.series.length)}).attr("class","bar").attr("width",g).attr("height",l-1),x.append("text").attr("x",function(t){return g(t)-3}).attr("y",l/2).attr("fill","red").attr("dy",".35em").text(function(t){return t}),x.append("text").attr("class","label").attr("x",function(t){return-10}).attr("y",i/2).attr("dy",".35em").text(function(t,e){return e%a.series.length===0?a.labels[Math.floor(e/a.series.length)]:""}),p.exit().transition().style({opacity:0}).remove(),f.append("g").attr("class","y axis").attr("transform","translate("+o+", "+-c/2+")").call(n);var b=18,v=4,y=f.selectAll(".legend").data(a.series),m=y.enter().append("g").attr("transform",function(t,e){var r=b+v,a=-c/2,n=o+s+40-b,l=e*r-a;return"translate("+n+","+l+")"});m.append("rect").attr("width",b).attr("height",b).style("fill",function(t,r){return e(r)}).style("stroke",function(t,r){return e(r)}),m.append("text").attr("class","legend").attr("x",b+v).attr("y",b-v).text(function(t){return t.label}),y.exit().remove()}var r,a,n,s=300,l=20,i=0,c=10,o=150,d=150,u=[];return{settings:{title:"barTitle",desc:"barDesc",barId:"#barId"},init:function(){r=this.settings.barId,d3.select("#barTitle").text(this.settings.title),d3.select("#barDesc").text(this.settings.desc),chart=d3.select(r).append("svg").attr("class","chart")},show:function(){e()}}}();
var Treemap=function(){function t(t){p=f=Utils.getTreeData(t);var a=i.nodes(f).filter(function(t){return!t.children}),s=c.selectAll("g").data(a,function(t){return t.watchers_count}).enter().append("g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).on("click",function(t){return r(p==t.parent?f:t.parent)});s.append("rect").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(t){return d(t.parent.name)}),s.append("text").attr("x",function(t){return 2*t.dx/3+20}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),1}),c.selectAll("g").data(a).exit().transition().style({opacity:0}).remove(),d3.select(window).on("click",function(){r(f)}),d3.select("#treemapSelect").on("change",function(){i.value("watchers"==this.value?e:n).nodes(f),r(p)})}function e(t){return t.watchers_count}function n(t){return t.forks_count}function r(t){var e=s/t.dx,n=o/t.dy;u.domain([t.x,t.x+t.dx]),l.domain([t.y,t.y+t.dy]);var r=c.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+u(t.x)+","+l(t.y)+")"});r.select("rect").attr("width",function(t){return e*t.dx-1}).attr("height",function(t){return n*t.dy-1}),r.select("text").attr("x",function(t){return 2*e*t.dx/3+20}).attr("y",function(t){return n*t.dy/2}).style("opacity",function(t){return 1}),p=t,d3.event.stopPropagation()}var a,i,c,s=970,o=500,u=d3.scale.linear().range([0,s]),l=d3.scale.linear().range([0,o]),d=d3.scale.category20c(),f=[],p=[];return{settings:{title:"treemapTitle",desc:"treemapDesc",treemapId:"#treemapId"},init:function(){var t=this.settings.treemapId;d3.select("#treemapTitle").text(this.settings.title),d3.select("#treemapDesc").text(this.settings.desc),a=d3.select(t).append("div").attr("class","chart").style("width",s+"px").style("height",o+"px"),c=a.append("svg").attr("width",s).attr("height",o).append("g").attr("transform","translate(.5,.5)"),i=d3.layout.treemap().size([s,o]).value(function(t){return t.watchers_count})},show:function(e){t(e)}}}();
!function(){function e(e){var a=setTimeout(function(){t.style.display="block"},300);e=e||"https://api.github.com/search/repositories?q=bitcoin&sort=forks&order=desc&per_page=100",d3.json(e,function(e,i){e&&(clearTimeout(a),t.style.display="none",alert("加载数据失败，请检查您的网络设置。")),Utils.getData(i),Bar.show(),Treemap.show(),clearTimeout(a),t.style.display="none"})}var t=document.getElementById("modal");Searcher.init(),Bar.settings={title:"Top100 BarChart",desc:"This is a good example.",barId:"#barId"},Bar.init(),Treemap.settings={title:"Top100 treemap",desc:"You can click the block to zoom it.",treemapId:"#sacdlTreemap"},Treemap.init(),Searcher.addListener(function(t){e(t)}),e()}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwic2VhcmNoZXIuanMiLCJiYXIuanMiLCJ0cmVlbWFwLmpzIiwiYXBwLmpzIl0sIm5hbWVzIjpbIlV0aWxzIiwiZGF0YVRvSnNvbiIsImxhbmd1YWdlcyIsInJlc3VsdCIsIm5hbWUiLCJjaGlsZHJlbiIsImRhdGFTZXQiLCJpdGVtcyIsImZvckVhY2giLCJpdGVtIiwiaW5kZXgiLCJsYW5ndWFnZSIsInJvb3QiLCJjaGlsZCIsImZ1bGxfbmFtZSIsIndhdGNoZXJzX2NvdW50IiwiZm9ya3NfY291bnQiLCJwdXNoIiwidHJlZURhdGEiLCJnZXREYXRhIiwiZGF0YSIsImdldEJhckRhdGEiLCJsYWJlbHMiLCJzZXJpZXMiLCJ2YWx1ZXMiLCJsZW5ndGgiLCJsYWJlbCIsImdldFN0YWNrRGF0YSIsImNvdW50IiwiZ2V0VHJlZURhdGEiLCJTZWFyY2hlciIsInBhcnNlUXVlcnkiLCJxdWVyeSIsInEiLCJpbnB1dFR4dCIsInByb3BlcnR5IiwiYXJyIiwia2V5IiwidXJsIiwiYmFzZUFwaVVybCIsImpvaW4iLCJjb25zb2xlIiwibG9nIiwic2VhcmNoTXNnIiwidGV4dCIsInNlYXJjaEJ0biIsImxpc3RlbmVycyIsInNvcnQiLCJvcmRlciIsInBlcl9wYWdlIiwic2V0dGluZ3MiLCJpbml0IiwiZDMiLCJzZWxlY3QiLCJ0aGlzIiwib24iLCJsaXN0ZW5lciIsImVycm9yIiwiYWRkTGlzdGVuZXIiLCJCYXIiLCJ6aXBwaW5nRGF0YSIsImkiLCJqIiwiemlwcGVkRGF0YSIsInNob3dCYXIiLCJncm91cEhlaWdodCIsImJhckhlaWdodCIsImNvbG9yIiwic2NhbGUiLCJjYXRlZ29yeTIwIiwiY2hhcnRIZWlnaHQiLCJnYXBCZXR3ZWVuR3JvdXBzIiwieCIsImxpbmVhciIsImRvbWFpbiIsIm1heCIsInJhbmdlIiwiY2hhcnRXaWR0aCIsInkiLCJ5QXhpcyIsInN2ZyIsImF4aXMiLCJ0aWNrRm9ybWF0IiwidGlja1NpemUiLCJvcmllbnQiLCJjaGFydCIsImF0dHIiLCJzcGFjZUZvckxhYmVscyIsInNwYWNlRm9yTGVnZW5kIiwiYmFyTm9kZXMiLCJzZWxlY3RBbGwiLCJkIiwiYmFyIiwiZW50ZXIiLCJhcHBlbmQiLCJNYXRoIiwiZmxvb3IiLCJleGl0IiwidHJhbnNpdGlvbiIsInN0eWxlIiwib3BhY2l0eSIsInJlbW92ZSIsImNhbGwiLCJsZWdlbmRSZWN0U2l6ZSIsImxlZ2VuZFNwYWNpbmciLCJsZWdlbmREYXRhIiwibGVnZW5kIiwiaGVpZ2h0Iiwib2Zmc2V0IiwiaG9yeiIsInZlcnQiLCJiYXJJZCIsInRpdGxlIiwiZGVzYyIsInNob3ciLCJUcmVlbWFwIiwic2hvd0NoYXJ0Iiwibm9kZSIsIm5vZGVzIiwidHJlZW1hcCIsImZpbHRlciIsImNlbGwiLCJ6b29tIiwicGFyZW50IiwiZHgiLCJkeSIsInciLCJnZXRDb21wdXRlZFRleHRMZW5ndGgiLCJ3aW5kb3ciLCJ2YWx1ZSIsIndhdGNoZXJzQ291bnQiLCJmb3Jrc0NvdW50Iiwia3giLCJreSIsImgiLCJ0IiwiZHVyYXRpb24iLCJldmVudCIsImFsdEtleSIsInN0b3BQcm9wYWdhdGlvbiIsImNhdGVnb3J5MjBjIiwidHJlZW1hcElkIiwibGF5b3V0Iiwic2l6ZSIsImxvYWRlciIsInNldFRpbWVvdXQiLCJsb2FkaW5nIiwiZGlzcGxheSIsImpzb24iLCJlcnIiLCJjbGVhclRpbWVvdXQiLCJhbGVydCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiXSwibWFwcGluZ3MiOiJBQUNBLEdBQUlBLE9BQVMsV0ErRlQsUUFBU0MsS0FDTCxHQUFJQyxNQUVBQyxHQUNBQyxLQUFRLFlBQ1JDLFlBR0osSUFBSUMsR0FBV0EsRUFBUUMsTUFBTyxDQUMxQixHQUFJQSxHQUFRRCxFQUFRQyxLQUVwQkEsR0FBTUMsUUFBUSxTQUFVQyxFQUFNQyxHQUNjLG1CQUE3QlIsR0FBVU8sRUFBS0UsWUFDdEJULEVBQVVPLEVBQUtFLFVBQVlELElBSW5DLEtBQUssR0FBSUMsS0FBWVQsR0FBVyxDQUNYLFNBQWJT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QkksUUFBUzhGLEdBQUs1RSxHQUNWLEdBQUkwRyxHQUFTQyxXQUFXLFdBQ3BCQyxFQUFRL0MsTUFBTWdELFFBQVUsU0FDekIsSUFFSDdHLEdBQU1BLEdBQU8sMEZBRWJjLEdBQUdnRyxLQUFLOUcsRUFBSyxTQUFTK0csRUFBS2pJLEdBQ25CaUksSUFDQUMsYUFBYU4sR0FDYkUsRUFBUS9DLE1BQU1nRCxRQUFVLE9BQ3hCSSxNQUFNLHNCQUdWdkosTUFBTW1CLFFBQVFDLEdBRWR1QyxJQUFJdUQsT0FDSkMsUUFBUUQsT0FFUm9DLGFBQWFOLEdBQ2JFLEVBQVEvQyxNQUFNZ0QsUUFBVSxTQS9DaEMsR0FBSUQsR0FBVU0sU0FBU0MsZUFBZSxRQUt0QzNILFVBQVNxQixPQUtUUSxJQUFJVCxVQUNBOEQsTUFBTyxrQkFDUEMsS0FBTSwwQkFDTkYsTUFBTyxVQUVYcEQsSUFBSVIsT0FLSmdFLFFBQVFqRSxVQUNKOEQsTUFBTyxpQkFDUEMsS0FBTSxzQ0FDTjRCLFVBQVcsaUJBRWYxQixRQUFRaEUsT0EwQlJyQixTQUFTNEIsWUFBWSxTQUFTcEIsR0FDMUI0RSxFQUFLNUUsS0FHVDRFIiwiZmlsZSI6InNhY2RsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIOaooeWdl+WMlue8lueoi+ekuuiMg+OAglxudmFyIFV0aWxzID0gKGZ1bmN0aW9uICgpIHtcbiAgICAvLyDlsYDpg6jlj5jph4/lrprkuYnjgIJcbiAgICB2YXIgZGF0YVNldCwgdHJlZURhdGE7XG5cbiAgICAvLyDlhazlhbHmlrnms5XvvIzmnKzkvovkuK3ljIXlkKvkuoZnZXREYXRhKCnjgIFnZXRCYXJEYXRhKCnjgIFnZXRTdGFja0RhdGEoKeS4jmdldFRyZWVEYXRhKCnjgIJcbiAgICByZXR1cm4ge1xuICAgICAgICBnZXREYXRhOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgZGF0YVNldCA9IGRhdGE7XG4gICAgICAgICAgICB0cmVlRGF0YSA9IGRhdGFUb0pzb24oKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgIERhdGEgZm9ybWF0OlxuICAgICAgICB7XG4gICAgICAgICAgICBsYWJlbHM6IFtcbiAgICAgICAgICAgICAgICAnYy9jKysnLCAncHl0aG9uJywgJ2phdmFzY3JpcHQnLFxuICAgICAgICAgICAgICAgICdqYXZhJywgJ3J1YnknLCAnaHRtbCdcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBzZXJpZXM6IFt7XG4gICAgICAgICAgICAgICAgbGFiZWw6ICdQcm9qZWN0cyBjb3VudCcsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbNCwgOCwgMTUsIDE2LCAyMywgNDJdIC8vY291bnRzXG4gICAgICAgICAgICB9XVxuICAgICAgICB9XG4gICAgICAgICovXG4gICAgICAgIGdldEJhckRhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IHRyZWVEYXRhLmNoaWxkcmVuO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBsYWJlbHM6IFtdLFxuICAgICAgICAgICAgICAgIHNlcmllczogW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdmFsdWVzID0gW107XG5cbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICByZXN1bHQubGFiZWxzLnB1c2goaXRlbS5uYW1lKTtcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaChpdGVtLmNoaWxkcmVuLmxlbmd0aCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICByZXN1bHQuc2VyaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGxhYmVsOiAnUHJvamVjdHMgY291bnQnLFxuICAgICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgIHsgbmFtZTogXCJyZXBvc1wiICwgXG4gICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VzOiBbICB7IGxhbmd1YWdlOiAnanMnLCBjb3VudDogMzAwMCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IGxhbmd1YWdlOiAncnVieScsIGNvdW50OiAxMzAwIH1dXG4gICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0U3RhY2tEYXRhOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgaXRlbXMgPSB0cmVlRGF0YS5jaGlsZHJlbjtcblxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICAgICAgICBuYW1lOiBcInJlcG9zXCIsXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2VzOiBbXVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLzEuIOehruWumuWIneWni+aVsOaNrlxuICAgICAgICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLm5hbWUgPT09IFwibnVsbFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkID0ge1xuICAgICAgICAgICAgICAgICAgICBsYW5ndWFnZTogaXRlbS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogaXRlbS5jaGlsZHJlbi5sZW5ndGhcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmVzdWx0Lmxhbmd1YWdlcy5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHJldHVybiBbcmVzdWx0XTtcbiAgICAgICAgfSxcbiAgICAgICAgLyoqIERhdGEgZm9ybWF0OlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJsYW5ndWFnZXNcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjaGlsZHJlblwiOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiamF2YXNjcmlwdFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjaGlsZHJlblwiOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcImltZmx5L215SURFXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXRjaGVyc19jb3VudFwiOiAxMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJmb3Jrc19jb3VudFwiOiA1MFxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0VHJlZURhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmVlRGF0YTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8v56eB5pyJ5pa55rOV77yM5YyF5ZCr5LqGZGF0YVRvSnNvbigp5LiObWVyZ2V0VG8oKeOAglxuICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgZnVuY3Rpb24gZGF0YVRvSnNvbigpIHtcbiAgICAgICAgdmFyIGxhbmd1YWdlcyA9IHt9O1xuXG4gICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgICBcIm5hbWVcIjogXCJsYW5ndWFnZXNcIixcbiAgICAgICAgICAgIFwiY2hpbGRyZW5cIjogW11cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkYXRhU2V0ICYmIGRhdGFTZXQuaXRlbXMpIHtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IGRhdGFTZXQuaXRlbXM7XG5cbiAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsYW5ndWFnZXNbaXRlbS5sYW5ndWFnZV0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VzW2l0ZW0ubGFuZ3VhZ2VdID0gaW5kZXg7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGZvciAodmFyIGxhbmd1YWdlIGluIGxhbmd1YWdlcykge1xuICAgICAgICAgICAgICAgIGlmIChsYW5ndWFnZSA9PT0gXCJudWxsXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2UgPSBcIm90aGVyc1wiO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICB2YXIgcm9vdCA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IGxhbmd1YWdlLFxuICAgICAgICAgICAgICAgICAgICBcImNoaWxkcmVuXCI6IFtdXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBpdGVtLmZ1bGxfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwid2F0Y2hlcnNfY291bnRcIjogaXRlbS53YXRjaGVyc19jb3VudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZm9ya3NfY291bnRcIjogaXRlbS5mb3Jrc19jb3VudFxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmxhbmd1YWdlID09PSBsYW5ndWFnZSB8fCAoaXRlbS5sYW5ndWFnZSA9PT0gXCJudWxsXCIgJiYgbGFuZ3VhZ2UgPT09IFwib3RoZXJzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByb290LmNoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICByZXN1bHQuY2hpbGRyZW4ucHVzaChyb290KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWVyZ2VUbyh0bywgZnJvbSkge1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZnJvbSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0b1trZXldID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgdG9ba2V5XSA9IGZyb21ba2V5XVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG59KCkpXG4iLCJ2YXIgU2VhcmNoZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIHZhciB1cmwgPSAnJyxcbiAgICAgICAgYmFzZUFwaVVybCxcbiAgICAgICAgaW5wdXRUeHQsXG4gICAgICAgIHNlYXJjaEJ0bixcbiAgICAgICAgc2VhcmNoTXNnLFxuICAgICAgICBsaXN0ZW5lcnMgPSBbXSxcbiAgICAgICAgcXVlcnkgPSB7XG4gICAgICAgICAgICBxOiAnYml0Y29pbicsXG4gICAgICAgICAgICBzb3J0OiBcImZvcmtzXCIsXG4gICAgICAgICAgICBvcmRlcjogXCJkZXNjXCIsXG4gICAgICAgICAgICBwZXJfcGFnZTogMTAwXG4gICAgICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgYmFzZUFwaVVybDogJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vc2VhcmNoL3JlcG9zaXRvcmllcydcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpbnB1dFR4dCA9IGQzLnNlbGVjdCgnI3NlYXJjaC1pbnB1dCcpO1xuICAgICAgICAgICAgc2VhcmNoQnRuID0gZDMuc2VsZWN0KCcjc2VhcmNoLWJ0bicpO1xuICAgICAgICAgICAgc2VhcmNoTXNnID0gZDMuc2VsZWN0KCcjc2VhcmNoLW1zZycpXG5cbiAgICAgICAgICAgIGJhc2VBcGlVcmwgPSB0aGlzLnNldHRpbmdzLmJhc2VBcGlVcmw7XG5cbiAgICAgICAgICAgIHNlYXJjaEJ0bi5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcGFyc2VRdWVyeSgpO1xuICAgICAgICAgICAgICAgIGxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChsaXN0ZW5lcikge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXIodXJsKTtcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZExpc3RlbmVyOiBmdW5jdGlvbiAobGlzdGVuZXIpIHtcbiAgICAgICAgICAgIGxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBwYXJzZVF1ZXJ5KCkge1xuICAgICAgICBxdWVyeS5xID0gaW5wdXRUeHQucHJvcGVydHkoJ3ZhbHVlJykgfHwgJ2JpdGNvaW4nO1xuICAgICAgICB2YXIgYXJyID0gW107XG5cbiAgICAgICAgZm9yICh2YXIga2V5IGluIHF1ZXJ5KSB7XG4gICAgICAgICAgICBhcnIucHVzaChrZXkgKyAnPScgKyBxdWVyeVtrZXldKTtcbiAgICAgICAgfTtcblxuICAgICAgICB1cmwgPSBiYXNlQXBpVXJsICsgJz8nICsgYXJyLmpvaW4oJyYnKTtcblxuICAgICAgICBjb25zb2xlLmxvZyh1cmwpO1xuICAgICAgICBzZWFyY2hNc2cudGV4dCgn5b2T5YmN5pCc57Si5Zyw5Z2AOiAnICsgdXJsKTtcbiAgICAgICAgcmV0dXJuIHVybDtcbiAgICB9XG59KCkpXG4iLCJ2YXIgQmFyID0gKGZ1bmN0aW9uKCkge1xuICAgIHZhciBjaGFydFdpZHRoID0gMzAwLFxuICAgICAgICBiYXJIZWlnaHQgPSAyMCxcbiAgICAgICAgZ3JvdXBIZWlnaHQgPSAwLFxuICAgICAgICBnYXBCZXR3ZWVuR3JvdXBzID0gMTAsXG4gICAgICAgIHNwYWNlRm9yTGFiZWxzID0gMTUwLFxuICAgICAgICBzcGFjZUZvckxlZ2VuZCA9IDE1MCxcbiAgICAgICAgYmFySWQsXG4gICAgICAgIHN2ZyxcbiAgICAgICAgZGF0YSxcbiAgICAgICAgeUF4aXM7XG5cbiAgICAvLyBaaXAgdGhlIHNlcmllcyBkYXRhIHRvZ2V0aGVyIChmaXJzdCB2YWx1ZXMsIHNlY29uZCB2YWx1ZXMsIGV0Yy4pXG4gICAgdmFyIHppcHBlZERhdGEgPSBbXTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICB0aXRsZTogXCJiYXJUaXRsZVwiLFxuICAgICAgICAgICAgZGVzYzogXCJiYXJEZXNjXCIsXG4gICAgICAgICAgICBiYXJJZDogXCIjYmFySWRcIlxuICAgICAgICB9LFxuXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYmFySWQgPSB0aGlzLnNldHRpbmdzLmJhcklkO1xuXG4gICAgICAgICAgICBkMy5zZWxlY3QoXCIjYmFyVGl0bGVcIikudGV4dCh0aGlzLnNldHRpbmdzLnRpdGxlKTtcbiAgICAgICAgICAgIGQzLnNlbGVjdChcIiNiYXJEZXNjXCIpLnRleHQodGhpcy5zZXR0aW5ncy5kZXNjKTtcblxuICAgICAgICAgICAgY2hhcnQgPSBkMy5zZWxlY3QoYmFySWQpLmFwcGVuZChcInN2Z1wiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJjaGFydFwiKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNob3dCYXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHppcHBpbmdEYXRhKGRhdGEpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxhYmVscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkYXRhLnNlcmllcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIHppcHBlZERhdGEucHVzaChkYXRhLnNlcmllc1tqXS52YWx1ZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0JhcigpIHtcbiAgICAgICAgLy9DbGVhblxuICAgICAgICB6aXBwZWREYXRhID0gW107XG5cbiAgICAgICAgZGF0YSA9IFV0aWxzLmdldEJhckRhdGEoKTtcbiAgICAgICAgZ3JvdXBIZWlnaHQgPSBiYXJIZWlnaHQgKiBkYXRhLnNlcmllcy5sZW5ndGg7XG5cbiAgICAgICAgemlwcGluZ0RhdGEoZGF0YSk7XG5cbiAgICAgICAgLy8gQ29sb3Igc2NhbGVcbiAgICAgICAgdmFyIGNvbG9yID0gZDMuc2NhbGUuY2F0ZWdvcnkyMCgpO1xuICAgICAgICB2YXIgY2hhcnRIZWlnaHQgPSBiYXJIZWlnaHQgKiB6aXBwZWREYXRhLmxlbmd0aCArIGdhcEJldHdlZW5Hcm91cHMgKiBkYXRhLmxhYmVscy5sZW5ndGg7XG5cbiAgICAgICAgdmFyIHggPSBkMy5zY2FsZS5saW5lYXIoKVxuICAgICAgICAgICAgLmRvbWFpbihbMCwgZDMubWF4KHppcHBlZERhdGEpXSlcbiAgICAgICAgICAgIC5yYW5nZShbMCwgY2hhcnRXaWR0aF0pO1xuXG4gICAgICAgIHZhciB5ID0gZDMuc2NhbGUubGluZWFyKClcbiAgICAgICAgICAgIC5yYW5nZShbY2hhcnRIZWlnaHQgKyBnYXBCZXR3ZWVuR3JvdXBzLCAwXSk7XG5cbiAgICAgICAgeUF4aXMgPSBkMy5zdmcuYXhpcygpXG4gICAgICAgICAgICAuc2NhbGUoeSlcbiAgICAgICAgICAgIC50aWNrRm9ybWF0KCcnKVxuICAgICAgICAgICAgLnRpY2tTaXplKDApXG4gICAgICAgICAgICAub3JpZW50KFwibGVmdFwiKTtcblxuICAgICAgICB2YXIgc3ZnID0gY2hhcnRcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgc3BhY2VGb3JMYWJlbHMgKyBjaGFydFdpZHRoICsgc3BhY2VGb3JMZWdlbmQpXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBjaGFydEhlaWdodCk7XG5cbiAgICAgICAgLy8gR2V0IHRoZSBub2Rlc1xuICAgICAgICB2YXIgYmFyTm9kZXMgPSBzdmcuc2VsZWN0QWxsKFwiZ1wiKS5kYXRhKHppcHBlZERhdGEsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICAgICAgICByZXR1cm4gW2QsIGldO1xuICAgICAgICB9KVxuXG4gICAgICAgIC8vIENyZWF0ZSBiYXJzXG4gICAgICAgIHZhciBiYXIgPSBiYXJOb2Rlc1xuICAgICAgICAgICAgLmVudGVyKClcbiAgICAgICAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwidHJhbnNsYXRlKFwiICsgc3BhY2VGb3JMYWJlbHMgKyBcIixcIiArIChpICogYmFySGVpZ2h0ICsgZ2FwQmV0d2Vlbkdyb3VwcyAqICgwLjUgKyBNYXRoLmZsb29yKGkgLyBkYXRhLnNlcmllcy5sZW5ndGgpKSkgKyBcIilcIjtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENyZWF0ZSByZWN0YW5nbGVzIG9mIHRoZSBjb3JyZWN0IHdpZHRoXG4gICAgICAgIGJhci5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgICAgICAuYXR0cihcImZpbGxcIiwgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcihpICUgZGF0YS5zZXJpZXMubGVuZ3RoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiYmFyXCIpXG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHgpXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBiYXJIZWlnaHQgLSAxKTtcblxuICAgICAgICAvLyBBZGQgdGV4dCBsYWJlbCBpbiBiYXJcbiAgICAgICAgYmFyLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHgoZCkgLSAzO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBiYXJIZWlnaHQgLyAyKVxuICAgICAgICAgICAgLmF0dHIoXCJmaWxsXCIsIFwicmVkXCIpXG4gICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcbiAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIERyYXcgbGFiZWxzXG4gICAgICAgIGJhci5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibGFiZWxcIilcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xMDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgZ3JvdXBIZWlnaHQgLyAyKVxuICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi4zNWVtXCIpXG4gICAgICAgICAgICAudGV4dChmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgJSBkYXRhLnNlcmllcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLmxhYmVsc1tNYXRoLmZsb29yKGkgLyBkYXRhLnNlcmllcy5sZW5ndGgpXTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBEZWxldGUgdGhlIGV4dHJhIG5vZGVzXG4gICAgICAgIGJhck5vZGVzLmV4aXQoKVxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLnN0eWxlKHtcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnJlbW92ZSgpO1xuXG4gICAgICAgIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwieSBheGlzXCIpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNwYWNlRm9yTGFiZWxzICsgXCIsIFwiICsgLWdhcEJldHdlZW5Hcm91cHMgLyAyICsgXCIpXCIpXG4gICAgICAgICAgICAuY2FsbCh5QXhpcyk7XG5cbiAgICAgICAgLy8gRHJhdyBsZWdlbmRcbiAgICAgICAgdmFyIGxlZ2VuZFJlY3RTaXplID0gMTgsXG4gICAgICAgICAgICBsZWdlbmRTcGFjaW5nID0gNDtcblxuICAgICAgICB2YXIgbGVnZW5kRGF0YSA9IHN2Zy5zZWxlY3RBbGwoJy5sZWdlbmQnKVxuICAgICAgICAgICAgLmRhdGEoZGF0YS5zZXJpZXMpO1xuXG4gICAgICAgIHZhciBsZWdlbmQgPSBsZWdlbmREYXRhXG4gICAgICAgICAgICAuZW50ZXIoKVxuICAgICAgICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBsZWdlbmRSZWN0U2l6ZSArIGxlZ2VuZFNwYWNpbmc7XG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IC1nYXBCZXR3ZWVuR3JvdXBzIC8gMjtcbiAgICAgICAgICAgICAgICB2YXIgaG9yeiA9IHNwYWNlRm9yTGFiZWxzICsgY2hhcnRXaWR0aCArIDQwIC0gbGVnZW5kUmVjdFNpemU7XG4gICAgICAgICAgICAgICAgdmFyIHZlcnQgPSBpICogaGVpZ2h0IC0gb2Zmc2V0O1xuICAgICAgICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBob3J6ICsgJywnICsgdmVydCArICcpJztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGxlZ2VuZC5hcHBlbmQoJ3JlY3QnKVxuICAgICAgICAgICAgLmF0dHIoJ3dpZHRoJywgbGVnZW5kUmVjdFNpemUpXG4gICAgICAgICAgICAuYXR0cignaGVpZ2h0JywgbGVnZW5kUmVjdFNpemUpXG4gICAgICAgICAgICAuc3R5bGUoJ2ZpbGwnLCBmdW5jdGlvbihkLCBpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yKGkpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvcihpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGxlZ2VuZC5hcHBlbmQoJ3RleHQnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2xlZ2VuZCcpXG4gICAgICAgICAgICAuYXR0cigneCcsIGxlZ2VuZFJlY3RTaXplICsgbGVnZW5kU3BhY2luZylcbiAgICAgICAgICAgIC5hdHRyKCd5JywgbGVnZW5kUmVjdFNpemUgLSBsZWdlbmRTcGFjaW5nKVxuICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmxhYmVsO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbGVnZW5kRGF0YS5leGl0KCkucmVtb3ZlKCk7XG4gICAgfVxufSgpKVxuIiwidmFyIFRyZWVtYXAgPSAoZnVuY3Rpb24oKSB7XG4gICAgdmFyIHcgPSA5NzAsXG4gICAgICAgIGggPSA1MDAsXG4gICAgICAgIHggPSBkMy5zY2FsZS5saW5lYXIoKS5yYW5nZShbMCwgd10pLFxuICAgICAgICB5ID0gZDMuc2NhbGUubGluZWFyKCkucmFuZ2UoWzAsIGhdKSxcbiAgICAgICAgY29sb3IgPSBkMy5zY2FsZS5jYXRlZ29yeTIwYygpLFxuICAgICAgICByb290ID0gW10sXG4gICAgICAgIG5vZGUgPSBbXSxcbiAgICAgICAgY2hhcnQsXG4gICAgICAgIHRyZWVtYXAsXG4gICAgICAgIHN2ZztcblxuICAgIHJldHVybiB7XG4gICAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgICAgICB0aXRsZTogXCJ0cmVlbWFwVGl0bGVcIixcbiAgICAgICAgICAgIGRlc2M6IFwidHJlZW1hcERlc2NcIixcbiAgICAgICAgICAgIHRyZWVtYXBJZDogXCIjdHJlZW1hcElkXCJcbiAgICAgICAgfSxcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0cmVlbWFwSWQgPSB0aGlzLnNldHRpbmdzLnRyZWVtYXBJZDtcblxuICAgICAgICAgICAgZDMuc2VsZWN0KFwiI3RyZWVtYXBUaXRsZVwiKS50ZXh0KHRoaXMuc2V0dGluZ3MudGl0bGUpO1xuICAgICAgICAgICAgZDMuc2VsZWN0KFwiI3RyZWVtYXBEZXNjXCIpLnRleHQodGhpcy5zZXR0aW5ncy5kZXNjKTtcblxuICAgICAgICAgICAgY2hhcnQgPSBkMy5zZWxlY3QodHJlZW1hcElkKS5hcHBlbmQoXCJkaXZcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwiY2hhcnRcIilcbiAgICAgICAgICAgICAgICAuc3R5bGUoXCJ3aWR0aFwiLCB3ICsgXCJweFwiKVxuICAgICAgICAgICAgICAgIC5zdHlsZShcImhlaWdodFwiLCBoICsgXCJweFwiKVxuXG4gICAgICAgICAgICBzdmcgPSBjaGFydFxuICAgICAgICAgICAgICAgIC5hcHBlbmQoXCJzdmdcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHcpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgaClcbiAgICAgICAgICAgICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIFwidHJhbnNsYXRlKC41LC41KVwiKTtcblxuICAgICAgICAgICAgdHJlZW1hcCA9IGQzLmxheW91dC50cmVlbWFwKClcbiAgICAgICAgICAgICAgICAvLyAucm91bmQoZmFsc2UpXG4gICAgICAgICAgICAgICAgLnNpemUoW3csIGhdKVxuICAgICAgICAgICAgICAgIC8vIC5zdGlja3koZmFsc2UpXG4gICAgICAgICAgICAgICAgLnZhbHVlKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQud2F0Y2hlcnNfY291bnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvdzogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgc2hvd0NoYXJ0KGRhdGEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0NoYXJ0KGRhdGEpIHtcbiAgICAgICAgbm9kZSA9IHJvb3QgPSBVdGlscy5nZXRUcmVlRGF0YShkYXRhKTtcblxuICAgICAgICB2YXIgbm9kZXMgPSB0cmVlbWFwLm5vZGVzKHJvb3QpXG4gICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gIWQuY2hpbGRyZW47XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB2YXIgY2VsbCA9IHN2Zy5zZWxlY3RBbGwoXCJnXCIpXG4gICAgICAgICAgICAuZGF0YShub2RlcywgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLndhdGNoZXJzX2NvdW50O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lbnRlcigpXG4gICAgICAgICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImNlbGxcIilcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyBkLnggKyBcIixcIiArIGQueSArIFwiKVwiO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gem9vbShub2RlID09IGQucGFyZW50ID8gcm9vdCA6IGQucGFyZW50KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGNlbGwuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGQuZHggLSAxO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5keSAtIDE7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0eWxlKFwiZmlsbFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yKGQucGFyZW50Lm5hbWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgY2VsbC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAyICogZC5keCAvIDMgKyAyMDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmR5IC8gMjtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjM1ZW1cIilcbiAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZC5uYW1lO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIGQudyA9IHRoaXMuZ2V0Q29tcHV0ZWRUZXh0TGVuZ3RoKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIGQuZHggPiBkLncgPyAxIDogMDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIHN2Zy5zZWxlY3RBbGwoXCJnXCIpXG4gICAgICAgICAgICAuZGF0YShub2RlcylcbiAgICAgICAgICAgIC5leGl0KClcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5zdHlsZSh7XG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5yZW1vdmUoKTtcblxuICAgICAgICBkMy5zZWxlY3Qod2luZG93KS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgem9vbShyb290KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZDMuc2VsZWN0KFwiI3RyZWVtYXBTZWxlY3RcIikub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0cmVlbWFwLnZhbHVlKHRoaXMudmFsdWUgPT0gXCJ3YXRjaGVyc1wiID8gd2F0Y2hlcnNDb3VudCA6IGZvcmtzQ291bnQpLm5vZGVzKHJvb3QpO1xuICAgICAgICAgICAgem9vbShub2RlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gd2F0Y2hlcnNDb3VudChkKSB7XG4gICAgICAgIHJldHVybiBkLndhdGNoZXJzX2NvdW50O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZvcmtzQ291bnQoZCkge1xuICAgICAgICByZXR1cm4gZC5mb3Jrc19jb3VudDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB6b29tKGQpIHtcbiAgICAgICAgdmFyIGt4ID0gdyAvIGQuZHgsXG4gICAgICAgICAgICBreSA9IGggLyBkLmR5O1xuICAgICAgICB4LmRvbWFpbihbZC54LCBkLnggKyBkLmR4XSk7XG4gICAgICAgIHkuZG9tYWluKFtkLnksIGQueSArIGQuZHldKTtcblxuICAgICAgICB2YXIgdCA9IHN2Zy5zZWxlY3RBbGwoXCJnLmNlbGxcIikudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24oZDMuZXZlbnQuYWx0S2V5ID8gNzUwMCA6IDc1MClcbiAgICAgICAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyB4KGQueCkgKyBcIixcIiArIHkoZC55KSArIFwiKVwiO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgdC5zZWxlY3QoXCJyZWN0XCIpXG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ga3ggKiBkLmR4IC0gMTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGt5ICogZC5keSAtIDE7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIHQuc2VsZWN0KFwidGV4dFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMiAqIGt4ICogZC5keCAvIDMgKyAyMDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBreSAqIGQuZHkgLyAyO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgZnVuY3Rpb24oZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgICAgIC8vIHJldHVybiBreCAqIGQuZHggPiBkLncgPyAxIDogMDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5vZGUgPSBkO1xuICAgICAgICBkMy5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbn0oKSlcbiIsIihmdW5jdGlvbigpIHtcbiAgICB2YXIgbG9hZGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibW9kYWxcIik7XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2hcbiAgICAgKi9cbiAgICBTZWFyY2hlci5pbml0KCk7XG5cbiAgICAvKipcbiAgICAgKiBzdGFydCBCYXJDaGFydFxuICAgICAqL1xuICAgIEJhci5zZXR0aW5ncyA9IHtcbiAgICAgICAgdGl0bGU6IFwiVG9wMTAwIEJhckNoYXJ0XCIsXG4gICAgICAgIGRlc2M6IFwiVGhpcyBpcyBhIGdvb2QgZXhhbXBsZS5cIixcbiAgICAgICAgYmFySWQ6IFwiI2JhcklkXCJcbiAgICB9XG4gICAgQmFyLmluaXQoKTtcblxuICAgIC8qKlxuICAgICAqIHN0YXJ0IHRyZWVtYXBcbiAgICAgKi9cbiAgICBUcmVlbWFwLnNldHRpbmdzID0ge1xuICAgICAgICB0aXRsZTogXCJUb3AxMDAgdHJlZW1hcFwiLFxuICAgICAgICBkZXNjOiBcIllvdSBjYW4gY2xpY2sgdGhlIGJsb2NrIHRvIHpvb20gaXQuXCIsXG4gICAgICAgIHRyZWVtYXBJZDogXCIjc2FjZGxUcmVlbWFwXCJcbiAgICB9XG4gICAgVHJlZW1hcC5pbml0KCk7XG5cbiAgICBmdW5jdGlvbiBzaG93KHVybCkge1xuICAgICAgICB2YXIgbG9hZGVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgfSwgMzAwKTtcblxuICAgICAgICB1cmwgPSB1cmwgfHwgJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vc2VhcmNoL3JlcG9zaXRvcmllcz9xPWJpdGNvaW4mc29ydD1mb3JrcyZvcmRlcj1kZXNjJnBlcl9wYWdlPTEwMCc7XG5cbiAgICAgICAgZDMuanNvbih1cmwsIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChsb2FkZXIpO1xuICAgICAgICAgICAgICAgIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICAgICAgICAgIGFsZXJ0KFwi5Yqg6L295pWw5o2u5aSx6LSl77yM6K+35qOA5p+l5oKo55qE572R57uc6K6+572u44CCXCIpXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBVdGlscy5nZXREYXRhKGRhdGEpO1xuXG4gICAgICAgICAgICBCYXIuc2hvdygpO1xuICAgICAgICAgICAgVHJlZW1hcC5zaG93KCk7XG5cbiAgICAgICAgICAgIGNsZWFyVGltZW91dChsb2FkZXIpO1xuICAgICAgICAgICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIFNlYXJjaGVyLmFkZExpc3RlbmVyKGZ1bmN0aW9uKHVybCkge1xuICAgICAgICBzaG93KHVybCk7XG4gICAgfSlcblxuICAgIHNob3coKTtcbn0pKClcbiJdfQ==
